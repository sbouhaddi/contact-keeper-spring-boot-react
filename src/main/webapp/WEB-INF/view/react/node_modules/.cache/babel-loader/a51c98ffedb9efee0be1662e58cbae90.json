{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bouhaddisabri/IdeaProjects/DependecyInjection-Spring5/contacts-api/src/main/webapp/WEB-INF/view/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bouhaddisabri/IdeaProjects/DependecyInjection-Spring5/contacts-api/src/main/webapp/WEB-INF/view/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/bouhaddisabri/IdeaProjects/DependecyInjection-Spring5/contacts-api/src/main/webapp/WEB-INF/view/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'./authContext';import AuthReducer from'./authReducer';import axios from'axios';import{REGISTER_SUCCESS,LOGIN_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../types';import setAuthToken from'../../utils/setAuthToken';var AuthState=function AuthState(_ref){var children=_ref.children;var initialState={token:localStorage.getItem('token'),isAuthenticated:null,user:null,loading:true,error:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//LOAD USER\nvar loadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAuthToken();_context.prev=1;_context.next=4;return axios.get(\"api/authenticate\");case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref2.apply(this,arguments);};}();//REGISTER USER\nvar registerUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(user){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/api/sign-up\",user);case 3:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function registerUser(_x){return _ref3.apply(this,arguments);};}();//LOGIN USER\nvar loginUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.post(\"/api/login\",data);case 3:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data});case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function loginUser(_x2){return _ref4.apply(this,arguments);};}();//LOGOUT\nvar logout=function logout(){dispatch({type:LOGOUT});};//CLEAR ERROR\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,user:state.user,loading:state.loading,error:state.error,registerUser:registerUser,clearErrors:clearErrors,loadUser:loadUser,loginUser:loginUser,logout:logout}},children);};export default AuthState;","map":{"version":3,"sources":["/Users/bouhaddisabri/IdeaProjects/DependecyInjection-Spring5/contacts-api/src/main/webapp/WEB-INF/view/react/src/context/auth/AuthState.js"],"names":["React","useReducer","AuthContext","AuthReducer","axios","REGISTER_SUCCESS","LOGIN_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","setAuthToken","AuthState","children","initialState","token","localStorage","getItem","isAuthenticated","user","loading","error","state","dispatch","loadUser","get","res","type","payload","data","registerUser","post","response","loginUser","logout","clearErrors"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport AuthContext from './authContext';\nimport AuthReducer from './authReducer';\nimport axios from 'axios';\nimport {\n  REGISTER_SUCCESS,\n  LOGIN_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n} from '../types';\n\nimport setAuthToken from '../../utils/setAuthToken';\n\nconst AuthState = ({ children }) => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    isAuthenticated: null,\n    user: null,\n    loading: true,\n    error: null,\n  };\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\n\n  //LOAD USER\n  const loadUser = async () => {\n    setAuthToken();\n\n    try {\n      const res = await axios.get(`api/authenticate`);\n      dispatch({\n        type: USER_LOADED,\n        payload: res.data,\n      });\n    } catch (error) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  //REGISTER USER\n  const registerUser = async (user) => {\n    try {\n      const res = await axios.post(`/api/sign-up`, user);\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data,\n      });\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: error.response.data,\n      });\n    }\n  };\n\n  //LOGIN USER\n  const loginUser = async (data) => {\n    try {\n      const res = await axios.post(`/api/login`, data);\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data,\n      });\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: error.response.data,\n      });\n    }\n  };\n\n  //LOGOUT\n  const logout = () => {\n    dispatch({\n      type: LOGOUT,\n    });\n  };\n\n  //CLEAR ERROR\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        user: state.user,\n        loading: state.loading,\n        error: state.error,\n        registerUser,\n        clearErrors,\n        loadUser,\n        loginUser,\n        logout,\n      }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}